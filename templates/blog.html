{% extends "base.html" %}

{% block title %}
<title>Blog | {{ config.title }}</title>
{% endblock title %}

{% block content %}

<div class="page-header">
  <div class="container">
    <h1 class="page-header__title">{{ section.title | default(value="Blog") }}</h1>
    {% if section.description %}
    <p class="page-header__desc">{{ section.description }}</p>
    {% endif %}
  </div>
</div>

<section class="blog-listing">
  <div class="container">

    {% if paginator %}
      {% set pages = paginator.pages %}
    {% else %}
      {% set pages = section.pages %}
    {% endif %}

    {% if pages %}
    <div class="blog-grid">
      {% for post in pages %}
      <a href="{{ post.permalink }}" class="blog-card">
        <div class="blog-card__body">
          <div class="blog-card__meta">
            {% if post.date %}
            <span class="blog-card__date">{{ post.date | date(format="%b %d, %Y") }}</span>
            {% endif %}
            {% if post.reading_time %}
            <span class="blog-card__reading-time">{{ post.reading_time }} min read</span>
            {% endif %}
          </div>

          <h2 class="blog-card__title">{{ post.title }}</h2>

          {% if post.description %}
          <p class="blog-card__desc">{{ post.description }}</p>
          {% elif post.summary %}
          <p class="blog-card__desc">{{ post.summary | striptags | truncate(length=150) }}</p>
          {% endif %}

          {% if post.taxonomies.tags %}
          <div class="blog-card__tags">
            {% for tag in post.taxonomies.tags %}
            <span class="tag">{{ tag }}</span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </a>
      {% endfor %}
    </div>

    {# Pagination #}
    {% if paginator and paginator.number_pagers > 1 %}
    <nav class="pagination" aria-label="Blog pagination">
      {% if paginator.previous %}
      <a href="{{ paginator.previous }}" class="pagination__link" aria-label="Previous page">&laquo; Prev</a>
      {% else %}
      <span class="pagination__link pagination__link--disabled" aria-disabled="true">&laquo; Prev</span>
      {% endif %}

      {% for pager in range(start=1, end=paginator.number_pagers + 1) %}
        {% set pager_url = paginator.base_url ~ pager ~ "/" %}
        {% if pager == 1 %}
          {% set pager_url = paginator.base_url %}
        {% endif %}
        {% if pager == paginator.current_index %}
        <span class="pagination__link pagination__link--active" aria-current="page">{{ pager }}</span>
        {% else %}
        <a href="{{ pager_url }}" class="pagination__link">{{ pager }}</a>
        {% endif %}
      {% endfor %}

      {% if paginator.next %}
      <a href="{{ paginator.next }}" class="pagination__link" aria-label="Next page">Next &raquo;</a>
      {% else %}
      <span class="pagination__link pagination__link--disabled" aria-disabled="true">Next &raquo;</span>
      {% endif %}
    </nav>
    {% endif %}

    {% else %}
    <div class="empty-state">
      <p class="empty-state__text">No posts yet. Check back soon.</p>
    </div>
    {% endif %}

  </div>
</section>

{% endblock content %}
